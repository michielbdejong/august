<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Meute - an unhosted messages/contacts/search app</title>
    <style>
      body { font:15px sans-serif; line-height:1.4em; color:#222 }
      nav {float:left; margin:3em}
      nav div { border-style:solid; border-radius:1em; margin: 1em; padding: 1em}
      nav div table tr td img { width:4em; height:4em; border-radius:1em }
      article table tr td img { width:3em; height:3em; border-radius:1em }
      article {float:left; margin-top:4em; padding:1em; border-style:solid; border-radius:1em}
    </style>
  </head>
  <body>
    <nav>
      <div class="box mainscreen">
        <h2>Search:</h2>
        <input oninput="filterContacts(this.value);">
      </div>
      <div class="box mainscreen" onclick="showBoxes('composescreen');">
        <h2>Contacts:</h2>
        <table id="contactsTable">
        </table>
      </div>
      <div class="box composescreen">
        <h2 style="display:inline">Message to:</h2>
        <table id="toTable">
        </table>
      </div>
      <div class="box readscreen">
        <h2 style="display:inline">Message from:</h2>
        <table id="fromTable">
        </table>
      </div>
    </nav>
    <article class="box mainscreen" onclick="showBoxes('readscreen');">
      <h2>Messages:</h2>
      <table id="messagesTable" border="1">
      </table>
    </article>
    <article class="box composescreen">
      <div>
        <input type="submit" value="back" onclick="showBoxes('mainscreen');">
        <input type="submit" value="email (first line is subject)">
        <input type="submit" value="irc (hit enter to send)">
      </div>
      <div>
        <textarea style="width:100%;height:6em"></textarea>
      </div>
    </article>
    <article class="box readscreen" style="width:40em">
      <div>
        <input type="submit" value="back" onclick="showBoxes('mainscreen');">
        <input type="submit" value="reply" onclick="showBoxes('composescreen');">
      </div>
      <div>
        <pre id="readPre" style="width:100%">
        </pre>
      </div>
    </article>
  </body>
  <script>
    function filterContacts(str) {
      var l, match, matchThis, theseTerms,
        matchTerms = str.trim().toLowerCase().split(' ');
      trs = document.getElementsByClassName('contactrow');
      for(var i=0; i<trs.length; i++) {
        match = true;
        for(var j=0; j<matchTerms.length; j++) {
          l=matchTerms[j].length;
          if(l>0) {
            matchThis=false;
            theseTerms = trs[i].getAttribute('data-search').split(' ');
            //console.log('matching '+matchTerms[j]+' against '+theseTerms.join(','));
            for(var k=0; k<theseTerms.length; k++) {
              if(theseTerms[k].substring(0, l).toLowerCase()==matchTerms[j]) {
                matchThis = true;
                break;
              }
            }
            if(!matchThis) {
              //console.log('no!');
              match = false;
              break;
            }
          }
        }
        if(match) {
          trs[i].style.display='block';
        } else {
          trs[i].style.display='none';
        }
      }
    }
    function showBoxes(screen) {
      var allBoxes = document.getElementsByClassName('box');
      for(var i=0; i<allBoxes.length; i++) {
        allBoxes[i].style.display=
            (allBoxes[i].classList.contains(screen)?'block':'none');
      }
    }
    function showContacts(contacts, table) {
      var str='';
      for(var i=0; i<contacts.length; i++) {
        str+='<tr class="contactrow" data-search="'+contacts[i].name+'"><td><img src="'+contacts[i].avatar+'" /></td><td>'+contacts[i].name+'</td></tr>';
      }
      document.getElementById(table).innerHTML=str;
    }
    function showMessages(messages, table) {
      var str='';
      for(var i=0; i<messages.length; i++) {
        str+='<tr><td><img src="'+messages[i].avatar+'" /> '+messages[i].name+'</td><td>'+messages[i].subject+'</td></tr>';
      }
      document.getElementById(table).innerHTML=str;
    }
    function loadMockData() {
      showContacts([
        { name: 'MC Solaar', avatar: 'mock/avatar6.png' },
        { name: 'Michiel de Jong', avatar: 'mock/avatar1.png' },
        { name: 'Michiel Leenaars', avatar: 'mock/avatar5.png' },
        { name: 'Dalai Lama', avatar: 'mock/avatar2.png' },
        { name: 'Krafty Kuts', avatar: 'mock/avatar4.png' },
        { name: 'A Skillz', avatar: 'mock/avatar3.png' }
      ], 'contactsTable');
      showContacts([
        { name: 'MC Solaar', avatar: 'mock/avatar6.png' },
      ], 'fromTable');
      showContacts([
        { name: 'A Skillz', avatar: 'mock/avatar3.png' }
      ], 'toTable');
      showMessages([
        { name: 'Dalai Lama', avatar: 'mock/avatar2.png', subject: 'Re: Announcing Meute v0.1' },
        { name: 'Michiel de Jong', avatar: 'mock/avatar1.png', subject: 'Announcing Meute v0.1'},
        { name: 'A Skillz', avatar: 'mock/avatar3.png', subject: 'Re: The funky technician is back' }
      ], 'messagesTable');
    }

    //...
    loadMockData();
    showBoxes('mainscreen');
  </script>
</html>
