<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      nav { width:20em; float:left }
      article { width:40em; float:left }
      article textarea { width: 40em; height: 20em }
    </style>
  </head>
  <body>
    <nav>
      <h1>Hello Meute!</h1>
      <ul id="target"></ul>
    </nav>
    <article>
      <textarea id="text"></textarea>
      <p>
        <input type="submit" value="Send" onclick="sendMessage();" />
      </p>
      <table id="history"><tr><td>timestamp</td><td>actor</td><td>text</td></tr></table>
    </article>
  </body>
  <script src="config.js"> </script>
  <script>
    //parse parameters from URL hash:
    var paramPairs = location.hash.substring(1).split('&'), i, params = {};
    for(i=0; i<paramPairs.length; i++) {
      var keyAndValue=paramPairs[i].split('=');
      params[keyAndValue[0]] = keyAndValue[1];
    }
    
    //add contacts to nav and history to table:
    var i, li, tr;
    for(i=0; i<contacts.length; i++) {
      li = document.createElement('li');
      li.innerHTML = '<a href="#target='+contacts[i]+'&welten='+params.welten+'&token='+params.token+'"'
        +' onclick="params.target=\''+contacts[i]+'\';">'+contacts[i]+'</a>';
      document.getElementById('target').appendChild(li);
    }
    if(history[params.target]) {
      for(i=0; i<history[params.target].length; i++) {
        tr = document.createElement('tr');
        tr.innerHTML = '<td>'+history[params.target][i].timestamp
          +'</td><td>'+history[params.target][i].actor
          +'</td><td>'+history[params.target][i].text
          +'</td>';
        document.getElementById('history').appendChild(tr);
      }
    }

    //connect with the user's Welten instance:
    var sock = new WebSocket(config.sockethub);
    sock.onopen = function() { console.log('open'); };
    sock.onmessage = function(e) { console.log(e.data); };
    sock.onclose = function() { console.log('closed'); };

    //send:
    function sendMessage() {
      var obj = {
        verb: 'send',
        target: params.target,
        object: document.getElementById('text').value,
        token: config.token
      };
      console.log('sending', obj);
      sock.send(JSON.stringify(obj));
    }

    //receive:
    //...
  </script>
</html>
